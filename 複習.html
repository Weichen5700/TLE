<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>114å¹´TLEè€ƒé¡Œè¤‡ç¿’</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: linear-gradient(45deg, #dcedc8, #b2dfdb); /* æŸ”å’Œç°ç¶ è‰² */
            background-size: 150% 150%;
            animation: gradientBG 60s ease infinite; /* å‹•ç•«æ¸›æ…¢è‡³60ç§’ */
            margin: 0;
            padding: 1.5rem; /* å¢åŠ é‚Šè· */
            min-height: 100vh;
            font-size: 1.1rem; /* åŸºç¤å­—é«”å¤§å°æå‡ */
            line-height: 1.6; /* å¢åŠ è¡Œè· */
            letter-spacing: 0.02em; /* å¢åŠ å­—è· */
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

		 .question-block {
            background-color: #ffffff;
            padding: 1.5rem; /* å¢åŠ å…§è· */
            margin-bottom: 1.5rem; /* å¢åŠ å¤–è· */
            border-radius: 0.9375rem;
            box-shadow: 0 0.25rem 0.5rem rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            max-height: 70vh;
            position: relative;
            cursor: pointer;
            transition: box-shadow 0.5s ease;
            display: block;
        }


        .question-block:hover {
            box-shadow: 0 0.9375rem 2.5rem rgba(0, 0, 0, 0.2); /* æ¸›å¼±é™°å½±å¼·åº¦ */
        }
		
        h1 {
            color: #333;
            font-size: 2em;
            margin-bottom: 1.5rem;
            animation: fadeIn 1.5s ease;
        }

        .question-content h3 {
            font-size: 1.6em;
            margin-bottom: 1rem;
            color: #4a90e2;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .option {
            background-color: white;
            color: black;
            padding: 0.75rem; /* å¢åŠ å…§è· */
            margin-bottom: 0.5rem;
            border-radius: 0.3125rem;
            transition: background-color 0.3s, color 0.3s;
        }

        .options div:hover {
            background-color: #ffb74d; /* æŸ”å’Œæ©™è‰² */
            transform: scale(1.05); /* ç¸®æ¸›æ”¾å¤§æ•ˆæœ */
            transform-origin: top left;
            box-shadow: 0 0.5rem 1rem rgba(255, 183, 77, 0.4);
        }

        .option.answer {
            background-color: #fff3cd; /* æ·ºé»ƒè‰² */
            color: #343a40; /* æ·±ç°æ–‡å­— */
        }

        .remark {
            background-color: #0dcaf0;
            padding: 0.75rem;
            margin-bottom: 0.75rem;
            border-radius: 0.3125rem;
        }

        .felo {
            background-color: #d0f5d0;
            padding: 0.75rem;
            margin-bottom: 0.75rem;
            border-radius: 0.3125rem;
        }

        .pic img {
            max-width: 100%;
            max-height: 18.75rem;
            margin-right: 0.625rem;
            border-radius: 0.3125rem;
        }

        .fixed-buttons {
            position: fixed;
            bottom: 1.25rem;
            left: 50%;
            transform: translateX(-50%);
            background-color: #fff;
            padding: 0.625rem 1.25rem;
            box-shadow: 0 -0.125rem 0.3125rem rgba(0, 0, 0, 0.1);
            border-radius: 0.625rem;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            width: 18.75rem;
        }

        .jump-to {
            display: flex;
            align-items: center;
            gap: 0.625rem;
        }

        .jump-to input {
            width: 5rem;
        }

        .result-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2.25rem;
            font-weight: bold;
            padding: 1.25rem;
            border-radius: 0.625rem;
            z-index: 1000;
        }

        #answer-count {
            position: fixed;
            bottom: 0.625rem;
            right: 0.625rem;
            font-size: 1.5rem;
        }

        .answer-count-container {
            display: flex;
            justify-content: space-between;
             margin-bottom: 0.75rem;
        }


		.question-class {
			color: #9b59b6; /* è‡ªè¨‚é¡è‰² */
		}
		

       

        /* æ‰‹æ©Ÿç‰ˆå·¦ä¸Šè§’å‚™è¨»æŒ‰éˆ• */
        .mobile-note-btn {
            display: none; /* é»˜èªéš±è— */
            position: fixed;
            top: 0;
            left: 0;
            width: 30px;
            height: 30px;
            background-color: #fff;
            border: 1px solid #ccc;
            border-radius: 4px;
            text-align: center;
            line-height: 28px; /* å‚ç›´å±…ä¸­æ–‡æœ¬ */
            font-size: 0.9em;
            z-index: 1001;
            cursor: pointer;
        }

        @media (max-width: 576px) {
            body {
                padding: 0.75rem;
                font-size: 1rem;
            }
            .question-block {
				padding: 0.75rem;
				min-height: 60vh; /* æ–°å¢æœ€å°é«˜åº¦ï¼Œç¢ºä¿æ»¿ç‰ˆæ„Ÿ */
				max-height: 80vh; /* æé«˜æœ€å¤§é«˜åº¦ï¼Œé¿å…å£“ç¸® */
				padding-bottom: 2rem; /* å¢åŠ åº•éƒ¨ç©ºé–“ï¼Œé¿å…æŒ‰éˆ•é®æ“‹ */
				display: none ; /* æ‰‹æ©Ÿç‰ˆåˆå§‹éš±è—ï¼Œå„ªå…ˆç´šæœ€é«˜ */
			}
			.option {
                padding: 0.5rem; /* æ‰‹æ©Ÿç‰ˆæ¸›å°‘å…§è· */
                margin-bottom: 0.25rem; /* æ‰‹æ©Ÿç‰ˆæ¸›å°‘å¤–è· */
            }
            .remark {
                padding: 0.5rem; /* æ‰‹æ©Ÿç‰ˆå‚™è¨»æ¬„æ›´ç·Šæ¹Š */
                margin-bottom: 0.5rem;
                font-size: 0.9rem; /* ç•¥å°å­—é«” */
            }
            .felo {
                padding: 0.5rem;
                margin-bottom: 0.5rem;
                font-size: 0.9rem;
            }
			
            .fixed-buttons {
                width: 90%;
                flex-direction: row;
                padding: 0.5rem;
            }
            .fixed-buttons .btn {
                width: 48%;
                margin-bottom: 0;
            }
            .jump-to input {
                width: 4rem;
            }
            .result-message {
                font-size: 1.5rem;
                padding: 0.75rem;
            }
            
            .pic img {
                max-height: 12.5rem;
            }
            .progress-header {
                padding: 0.25rem 0.5rem;
                font-size: 1em;
            }
           .navbar-toggler {
				width: 45px;
				height: 45px;
				display: flex;
				align-items: center;
				justify-content: center;
				background-color: white;
				border: 2px solid #ccc;
				border-radius: 8px;
				padding: 0;
				transition: background-color 0.3s, box-shadow 0.3s;
			}

			.navbar-toggler:hover {
				background-color: #f0f0f0;
				box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
			}

			.custom-toggler-icon {
				width: 70%;
				height: 4px;
				background-color: black;
				position: relative;
				border-radius: 2px;
				transition: background-color 0.3s ease-in-out;
			}

			/* å‰å‰çš„å…©æ¢ç·š */
			.custom-toggler-icon::before,
			.custom-toggler-icon::after {
				content: "";
				position: absolute;
				left: 50%; /* è®“å®ƒå¾æ­£ä¸­å¿ƒé–‹å§‹ */
				width: 100%;
				height: 4px;
				background-color: black;
				border-radius: 2px;
				transition: transform 0.3s ease-in-out;
				transform-origin: center; /* è®“æ—‹è½‰ä»¥ä¸­å¿ƒé»ç‚ºåŸºæº– */
			}

			.custom-toggler-icon::before {
				top: -10px;
				transform: translateX(-50%);
			}

			.custom-toggler-icon::after {
				top: 10px;
				transform: translateX(-50%);
			}

			/* ğŸ”¥ ä¿®æ­£è®Šå‰å‰æ™‚çš„å°é½Š */
			.navbar-toggler[aria-expanded="true"] .custom-toggler-icon {
				background-color: transparent;
			}

			.navbar-toggler[aria-expanded="true"] .custom-toggler-icon::before {
				transform: translateX(-50%) rotate(45deg);
				top: 0; /* ç¢ºä¿è®Šå½¢å¾Œåœ¨æ­£ä¸­å¿ƒ */
			}

			.navbar-toggler[aria-expanded="true"] .custom-toggler-icon::after {
				transform: translateX(-50%) rotate(-45deg);
				top: 0; /* ç¢ºä¿è®Šå½¢å¾Œåœ¨æ­£ä¸­å¿ƒ */
			}

            #collapseSettings {
                background-color: #fff;
                border-radius: 0.625rem;
                padding: 0.5rem;
                max-height: 70vh;
                overflow-y: auto;
            }
            .question-content h3 {
                font-size: 1.2em;
            }
            .note-btn {
                display: none;
            }
            #toggle-checkboxes {
                display: none; /* æ‰‹æ©Ÿç‰ˆéš±è—æ¨™é¡Œ */
            }
            .mobile-note-btn {
                display: block; /* æ‰‹æ©Ÿç‰ˆé¡¯ç¤ºå‚™è¨»æŒ‰éˆ• */
            }
        }

        @media (min-width: 577px) and (max-width: 768px) {
            body {
                font-size: 1.25rem;
            }
            .question-block {
                 padding: 1.25rem;
                max-height: 65vh;
            }
            .fixed-buttons {
                width: 15rem;
            }
            .progress-header {
                padding: 0.5rem;
                font-size: 1.2em;
            }
        }

        .progress-header {
            padding: 0.5rem;
            font-size: 1.2em;
            text-align: center;
            position: relative;
        }
		  /* å¤œé–“æ¨¡å¼ */
        body.dark-mode {
            background: linear-gradient(45deg, #2d3436, #636e72);
            color: #dfe6e9;
        }
        .dark-mode .question-block {
            background-color: #2d3436;
            color: #dfe6e9;
        }
        .dark-mode .option {
            background-color: #636e72;
            color: #dfe6e9;
        }
        .dark-mode .option.answer {
            background-color: #b2bec3;
            color: #2d3436;
        }
        .dark-mode .fixed-buttons {
            background-color: #2d3436;
        }
		
		
    </style>
</head>
<body>
<div class="container">
    <h2 class="mb-2" id="toggle-checkboxes" style="text-align: center; color: #9A0036;">TLE</h2>

    <div class="row mb-1">
        <div class="col-12 progress-header">
            <strong>ç•¶å‰é¡Œè™Ÿ/ç¸½é¡Œæ•¸:</strong> <span id="current-question">0</span>/<span id="total-questions">0</span>
            <button class="navbar-toggler d-md-none float-end" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSettings" aria-expanded="false" aria-controls="collapseSettings">
                  <span class="custom-toggler-icon"></span>
            </button>
            <button class="btn btn-secondary d-none d-md-inline-block float-end" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSettings" aria-expanded="false" aria-controls="collapseSettings">
                é¡¯ç¤º/éš±è—è¨­å®š
            </button>
			 <button class="btn btn-dark float-end ms-2" onclick="toggleDarkMode()">å¤œé–“æ¨¡å¼</button> <!-- æ–°å¢å¤œé–“æ¨¡å¼æŒ‰éˆ• -->
			 
        </div>
    </div>

    <div class="row">
        <div class="col-12 collapse" id="collapseSettings">
            <div class="form-check mb-2">
                <input class="form-check-input" type="checkbox" id="shuffleOptions" onchange="renderQuestion()">
                <label class="form-check-label" for="shuffleOptions">0. æ‰“äº‚ç­”æ¡ˆé †åº</label>
            </div>
            <div class="form-check mb-2">
                <input class="form-check-input" type="checkbox" id="randomOrder" onchange="toggleRandomOrder()">
                <label class="form-check-label" for="randomOrder">1. äº‚æ•¸é¡¯ç¤ºé¡Œç›®</label>
            </div>
            <div class="form-check mb-2">
                <input class="form-check-input" type="checkbox" id="hideAnswers" onchange="toggleAnswerVisibility()">
                <label class="form-check-label" for="hideAnswers">2. é®ä½ç­”æ¡ˆ</label>
            </div>
            <div class="mb-2 jump-to">
                <label for="jump-input">3. è·³è‡³é¡Œè™Ÿï¼š</label>
                <input type="number" id="jump-input" placeholder="è¼¸å…¥é¡Œè™Ÿ" min="1">
                <button class="btn btn-jump btn-primary" onclick="jumpToQuestion()">è·³é¡Œ</button>
            </div>
            <div class="form-check mb-2">
                <input class="form-check-input" type="checkbox" id="hideRemark" onchange="toggleRemarkVisibility()" checked>
                <label class="form-check-label" for="hideRemark">4. éš±è—å‚™è¨»</label>
            </div>
            <div class="form-check mb-2">
                <input class="form-check-input" type="checkbox" id="hideFelo" onchange="toggleFeloVisibility()" checked>
                <label class="form-check-label" for="hideFelo">5. éš±è—Felo</label>
            </div>
            <div class="form-check mb-2">
                <input class="form-check-input" type="checkbox" id="hidePic" onchange="togglePicVisibility()" checked>
                <label class="form-check-label" for="hidePic">6. éš±è—Pic</label>
            </div>
            <div class="mb-2">
                <label for="categoryFilter">7. éæ¿¾é¡åˆ¥ï¼š</label>
                <select id="categoryFilter" class="form-select" onchange="filterByCategory()">
                    <option value="">å…¨é¸</option>
                </select>
            </div>
            <div class="mb-2">
                <label for="keywordFilter">8. éæ¿¾é¡Œç›®ï¼š</label>
                <input type="text" id="keywordFilter" class="form-control" placeholder="ä½¿ç”¨ã€Œ+ã€ä»£è¡¨ANDï¼Œç”¨ã€Œ,ã€æˆ–ã€Œï¼Œã€ä»£è¡¨ORï¼Œç”¨ã€Œ!ã€æˆ–ã€Œ-ã€ä»£è¡¨NOT" oninput="filterByKeywords()">
            </div>
            <div class="mb-2">
                <label for="feloFilter">9. éæ¿¾Feloï¼š</label>
                <input type="text" id="feloFilter" class="form-control" placeholder="ä½¿ç”¨ã€Œ+ã€ä»£è¡¨ANDï¼Œç”¨ã€Œ,ã€æˆ–ã€Œï¼Œã€ä»£è¡¨ORï¼Œç”¨ã€Œ!ã€æˆ–ã€Œ-ã€ä»£è¡¨NOT" oninput="filterByFelo()">
            </div>
            <div class="mb-2">
                <label for="questionTypeFilter">10. é¡Œå‹ç¯©é¸ï¼š</label>
                <select id="questionTypeFilter" class="form-select" onchange="filterByQuestionType()">
                    <option value="">å…¨éƒ¨</option>
                    <option value="å–®é¸é¡Œ">å–®é¸é¡Œ</option>
                    <option value="è¤‡é¸é¡Œ">è¤‡é¸é¡Œ</option>
                </select>
            </div>
            <div class="mb-2">
                <label>11. ä¿®æ”¹ç­†è¨˜ä¸¦åŒ¯å‡º</label>
                <button class="btn btn-secondary mt-3" onclick="exportModifiedQuestions()">åŒ¯å‡ºä¿®æ”¹å¾Œæª”æ¡ˆ</button>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12 answer-count-container">
            <span id="correct-count" style="color: green; font-size: 1.5rem;">ç­”å°: 0</span>
            <span id="incorrect-count" style="color: red; font-size: 1.5rem;">ç­”éŒ¯: 0</span>
        </div>
    </div>

		   <div class="row position-relative">
			<button class="mobile-note-btn" onclick="toggleMobileNotes()">åœ–</button>
			<div class="col-12">
				<div id="question-container" class="question-block"></div>
			</div>
		</div>

    <div class="row">
        <div class="col-12">
            <button id="github-load-btn" class="btn btn-success mt-2" onclick="loadFromGitHub()">å¾ GitHub è¼‰å…¥</button>
            <input type="file" id="fileInput" accept=".txt" class="form-control mt-2" onchange="readFile()">
			<button id="github-info-btn"  class="btn btn-info mt-4" onclick="startinfo()">å…¶ä»–info</button>
        </div>
    </div>
</div>

<button id="copy-button" class="btn btn-secondary" style="display: none; position: fixed; bottom: 5rem; right: 0.625rem;">
    <img src="https://img.icons8.com/ios-filled/50/000000/copy.png" alt="Copy Icon" style="width: 1.25rem; height: 1.25rem;">
</button>

<div class="fixed-buttons">
    <button class="btn btn-primary" onclick="prevQuestion()">ä¸Šä¸€é¡Œ</button>
    <button class="btn btn-primary" onclick="nextQuestion()">ä¸‹ä¸€é¡Œ</button>
</div>

<div class="background-shapes">
    <div class="shape" style="left: 5%; animation-duration: 12s;"></div>
    <div class="shape" style="left: 15%; animation-duration: 10s;"></div>
    <div class="shape" style="left: 25%; animation-duration: 14s;"></div>
    <div class="shape" style="left: 35%; animation-duration: 11s;"></div>
    <div class="shape" style="left: 45%; animation-duration: 13s;"></div>
    <div class="shape" style="left: 55%; animation-duration: 12s;"></div>
    <div class="shape" style="left: 65%; animation-duration: 15s;"></div>
    <div class="shape" style="left: 75%; animation-duration: 9s;"></div>
    <div class="shape" style="left: 85%; animation-duration: 16s;"></div>
    <div class="shape" style="left: 95%; animation-duration: 10s;"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
<script>

  function toggleDarkMode() {
        document.body.classList.toggle('dark-mode');
    }
    let questions = [];
    let filteredQuestions = [];
    let currentIndex = 0;
    let randomOrder = false;
    let randomIndices = [];
    let answerRevealed = false;
    let categories = [];
    let isMultipleChoice = false;
    let answered = false;

    document.getElementById('categoryFilter').addEventListener('change', applyFilters);
    document.getElementById('keywordFilter').addEventListener('input', applyFilters);
    document.getElementById('feloFilter').addEventListener('input', applyFilters);

    function loadFromGitHub() {
        const githubFileUrl = 'https://weichen5700.github.io/TLE/uploadfile.txt'; // æ›¿æ›ç‚ºä½ çš„ GitHub URL
        fetch(githubFileUrl)
            .then(response => {
                if (!response.ok) throw new Error('ç„¡æ³•å¾ GitHub è¼‰å…¥ uploadfile.txt');
                return response.text();
            })
            .then(data => {
                const lines = data.split('\n').filter(Boolean);
                questions = lines.map(line => {
                    const question = JSON.parse(line);
                    question.sn = formatSn(question.sn);
                    return question;
                });
                document.getElementById('total-questions').textContent = questions.length;
                randomIndices = [...Array(questions.length).keys()];
                if (randomOrder) shuffle(randomIndices);
                currentIndex = 0;
                categories = [...new Set(questions.map(q => q.class))];
                filteredQuestions = [...questions];
                populateCategoryFilter();
                renderQuestion();
                document.getElementById('fileInput').style.display = 'none';
                document.getElementById('github-load-btn').style.display = 'none';
				document.getElementById('github-info-btn').style.display = 'none';
            })
            .catch(error => {
                console.error('è¼‰å…¥å¤±æ•—:', error);
                alert('ç„¡æ³•å¾ GitHub è¼‰å…¥ï¼Œè«‹æª¢æŸ¥ URL æˆ–ä½¿ç”¨æ‰‹å‹•ä¸Šå‚³ã€‚');
            });
    }

    function readFile() {
        const fileInput = document.getElementById('fileInput');
        const file = fileInput.files[0];
        if (!file) {
            alert('è«‹é¸æ“‡ä¸€å€‹æª”æ¡ˆ');
            return;
        }
        const reader = new FileReader();
        reader.onload = function(event) {
            const lines = event.target.result.split('\n').filter(Boolean);
            try {
                questions = lines.map(line => {
                    const question = JSON.parse(line);
                    question.sn = formatSn(question.sn);
                    return question;
                });
                document.getElementById('total-questions').textContent = questions.length;
                randomIndices = [...Array(questions.length).keys()];
                if (randomOrder) shuffle(randomIndices);
                currentIndex = 0;
                categories = [...new Set(questions.map(q => q.class))];
                filteredQuestions = [...questions];
                populateCategoryFilter();
                renderQuestion();
                fileInput.style.display = 'none';
                document.getElementById('github-load-btn').style.display = 'none';
				document.getElementById('github-info-btn').style.display = 'none';
            } catch (error) {
                alert('æª”æ¡ˆæ ¼å¼éŒ¯èª¤ï¼Œè«‹ç¢ºä¿æ¯è¡Œæ˜¯æœ‰æ•ˆçš„ JSON');
                console.error(error);
            }
        };
        reader.readAsText(file);
    }

    function parseFilterInput(input) {
        const andKeywords = input.split('+').map(kw => kw.trim());
        return andKeywords.map(andGroup => 
            andGroup.split(/[,ï¼Œ]/).map(kw => {
                if (kw.startsWith('!') || kw.startsWith('-')) {
                    return { type: 'NOT', keyword: kw.slice(1).trim() };
                }
                return { type: 'INCLUDE', keyword: kw.trim() };
            }).filter(Boolean)
        );
    }

    function populateCategoryFilter() {
        const categoryFilter = document.getElementById('categoryFilter');
        categoryFilter.innerHTML = '<option value="">å…¨é¸</option>';
        categories.forEach(category => {
            const option = document.createElement('option');
            option.value = category;
            const questionCount = questions.filter(q => q.class === category).length;
            option.textContent = `${category} (${questionCount})`;
            categoryFilter.appendChild(option);
        });
    }

    function filterByKeywords() {
        const input = document.getElementById('keywordFilter').value;
        if (!input.trim()) {
            filteredQuestions = [...questions];
        } else {
            const keywordGroups = parseFilterInput(input);
            filteredQuestions = questions.filter(q => 
                keywordGroups.every(group => {
                    return group.some(({ type, keyword }) => 
                        type === 'INCLUDE' ? q.question.includes(keyword) : !q.question.includes(keyword)
                    );
                })
            );
        }
        resetRandomIndices();
        currentIndex = 0;
        document.getElementById('total-questions').textContent = filteredQuestions.length;
        renderQuestion();
    }

    function filterByFelo() {
        const input = document.getElementById('feloFilter').value;
        if (!input.trim()) {
            filteredQuestions = [...questions];
        } else {
            const feloKeywordGroups = parseFilterInput(input);
            filteredQuestions = questions.filter(q => 
                feloKeywordGroups.every(group => {
                    return group.some(({ type, keyword }) => 
                        q.felo && (type === 'INCLUDE' ? q.felo.includes(keyword) : !q.felo.includes(keyword))
                    );
                })
            );
        }
        resetRandomIndices();
        currentIndex = 0;
        document.getElementById('total-questions').textContent = filteredQuestions.length;
        renderQuestion();
    }

    function filterByCategory() {
        const selectedCategory = document.getElementById('categoryFilter').value;
        if (selectedCategory === "") {
            filteredQuestions = [...questions];
        } else {
            filteredQuestions = questions.filter(q => q.class === selectedCategory);
        }
        resetRandomIndices();
        currentIndex = 0;
        document.getElementById('total-questions').textContent = filteredQuestions.length;
        renderQuestion();
    }

    function resetRandomIndices() {
        randomIndices = [...Array(filteredQuestions.length).keys()];
        if (randomOrder) shuffle(randomIndices);
    }

    document.getElementById('keywordFilter').addEventListener('blur', function() {
        if (!this.value.trim()) filterByKeywords();
    });

    document.getElementById('feloFilter').addEventListener('blur', function() {
        if (!this.value.trim()) filterByFelo();
    });

   function renderQuestion() {
    const questionContainer = document.getElementById('question-container');

    if (filteredQuestions.length === 0) {
        questionContainer.innerHTML = '<p>æ²’æœ‰ç¬¦åˆç¯©é¸æ¢ä»¶çš„é¡Œç›®ã€‚</p>';
        questionContainer.style.display = 'block'; // ç„¡è«–æ‰‹æ©Ÿæˆ–æ¡Œé¢ï¼Œç©ºçµæœæ™‚é¡¯ç¤º
        return;
    }

    // æ ¹æ“šè¢å¹•å°ºå¯¸æ±ºå®šæ˜¯å¦é¡¯ç¤º
    const isMobile = window.innerWidth <= 576;
    if (!isMobile) {
        questionContainer.style.display = 'block'; // æ¡Œé¢ç‰ˆå§‹çµ‚é¡¯ç¤º
    } else if (filteredQuestions.length > 0) {
        questionContainer.style.display = 'block'; // æ‰‹æ©Ÿç‰ˆåªæœ‰åœ¨æœ‰é¡Œç›®æ™‚é¡¯ç¤º
    }

    const q = filteredQuestions[randomOrder ? randomIndices[currentIndex] : currentIndex];
    document.getElementById('current-question').textContent = currentIndex + 1;
    document.getElementById('total-questions').textContent = filteredQuestions.length;

    let options = [...q.options];
    if (document.getElementById('shuffleOptions').checked) {
        options = shuffleOptions(options);
    }

    isMultipleChoice = options.filter(opt => opt.answer === true).length > 1;
    let html = `
    <div class="question-content" style="position: relative;">
        <h3>é¡Œç›® ${q.sn}: <span class="question-class">[${q.class}]</span> ${q.question}</h3>
        <div class="options">
            ${options.map((opt, i) => `
                <div class="option" data-answer="${opt.answer}" data-text="é¸é … ${i + 1}: ${opt.option}">
                    <input type="checkbox" class="answer-checkbox" id="option-${i}">
                    <label for="option-${i}">é¸é … ${i + 1}: ${opt.option}</label>
                </div>
            `).join('')}
        </div>
        <div class="remark" style="display: block;">å‚™è¨»: ${q.remark || 'ç„¡'}</div>
        <div class="felo" style="display: block;">Felo: ${q.felo || 'ç„¡'}</div>
        <div class="pic" style="display: block;">${renderPics(q.pic)}</div>
        <button class="btn btn-info btn-sm mt-2 note-btn" onclick="toggleNoteSection('${q.class}', '${formatSn(q.sn)}')">è¨»è¨˜</button>
        <div id="note-section-${q.class}-${formatSn(q.sn)}" class="note-section" style="display: none; margin-top: 0.625rem;">
            <textarea class="form-control" id="note-input-${q.class}-${formatSn(q.sn)}" rows="3" placeholder="è¼¸å…¥ç­†è¨˜...">${q.felo || ''}</textarea>
            <div class="mt-2">
                <button class="btn btn-outline-primary btn-sm" onclick="markDifficulty('${q.class}', '${formatSn(q.sn)}', 'ç°¡å–®')">ç°¡å–®</button>
                <button class="btn btn-outline-warning btn-sm" onclick="markDifficulty('${q.class}', '${formatSn(q.sn)}', 'ä¸­ç­‰')">ä¸­ç­‰</button>
                <button class="btn btn-outline-danger btn-sm" onclick="markDifficulty('${q.class}', '${formatSn(q.sn)}', 'å›°é›£')">å›°é›£</button>
                <button class="btn btn-success btn-sm" onclick="saveNote('${q.class}', '${formatSn(q.sn)}')">ä¿å­˜</button>
            </div>
        </div>
    </div>
    `;

    questionContainer.innerHTML = html;

    if (isMultipleChoice) {
        const submitButton = document.createElement('button');
        submitButton.id = 'submit-button';
        submitButton.classList.add('btn', 'btn-primary');
        submitButton.textContent = 'é€å‡ºç­”æ¡ˆ';
        submitButton.onclick = checkMultipleChoice;
        questionContainer.appendChild(submitButton);
    }

    toggleAnswerVisibility();
    toggleRemarkVisibility();
    toggleFeloVisibility();
    togglePicVisibility();

    document.getElementById('github-load-btn').style.display = 'none';
	document.getElementById('github-info-btn').style.display = 'none';
}

    function formatSn(sn) {
        return sn.toString().padStart(3, '0');
    }

    function toggleNoteSection(className, sn) {
        const input = document.getElementById(`note-section-${className}-${sn}`);
        if (!input) {
            console.error(`ç„¡æ³•æ‰¾åˆ° ID ç‚º note-section-${className}-${sn} çš„å…ƒç´ `);
            return;
        }
        input.style.display = input.style.display === 'none' ? 'block' : 'none';
    }

    function markDifficulty(className, sn, level) {
        const input = document.getElementById(`note-input-${className}-${sn}`);
        if (!input) {
            console.error(`ç„¡æ³•æ‰¾åˆ° ID ç‚º note-input-${className}-${sn} çš„å…ƒç´ `);
            return;
        }
        input.value = `[${level}] ${input.value}`;
    }

    function saveNote(className, sn) {
        const input = document.getElementById(`note-input-${className}-${sn}`);
        if (!input) {
            console.error(`ç„¡æ³•æ‰¾åˆ° ID ç‚º note-input-${className}-${sn} çš„å…ƒç´ `);
            return;
        }
        const question = questions.find(q => q.class === className && formatSn(q.sn) === sn);
        if (question) {
            question.felo = input.value;
            alert(`é¡Œç›® ${className}-${sn} è¨»è¨˜å·²ä¿å­˜ï¼`);
        }
    }

    function exportModifiedQuestions() {
        const updatedData = questions.map(q => JSON.stringify(q)).join('\n');
        const blob = new Blob([updatedData], { type: 'text/plain' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'updated_questions.txt';
        link.click();
        document.getElementById('github-load-btn').style.display = 'block';
        document.getElementById('fileInput').style.display = 'block';
    }

    document.addEventListener('keydown', function(event) {
        if (event.key === '+') {
            const section = document.querySelector('.note-section');
            if (section) {
                section.style.display = section.style.display === 'none' ? 'block' : 'none';
            }
        }
    });

    function toggleRandomOrder() {
        randomOrder = document.getElementById('randomOrder').checked;
        resetRandomIndices();
        currentIndex = 0;
        renderQuestion();
    }

    function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    let correctCount = 0;
    let incorrectCount = 0;

    function toggleAnswerVisibility() {
        const hideAnswers = document.getElementById('hideAnswers').checked;
        const options = Array.from(document.querySelectorAll('.option'));
        const answerCountContainer = document.querySelector('.answer-count-container');
        if (hideAnswers) {
            answerCountContainer.style.display = 'flex';
        } else {
            answerCountContainer.style.display = 'none';
            correctCount = 0;
            incorrectCount = 0;
            updateAnswerCount();
        }

        if (!hideAnswers) {
            correctCount = 0;
            incorrectCount = 0;
            updateAnswerCount();
        }

        answerRevealed = false;
        const existingSubmitButton = document.getElementById('submit-button');
        if (existingSubmitButton) {
            existingSubmitButton.remove();
        }

        const isMultipleChoice = options.length > 1 && options.filter(opt => opt.dataset.answer === "true").length > 1;

        if (hideAnswers) {
            if (isMultipleChoice) {
                options.forEach((option, i) => {
                    const checkboxId = `option-${i}`;
                    option.innerHTML = `
                        <div>
                            <input type="checkbox" id="${checkboxId}" class="answer-checkbox">
                            <label for="${checkboxId}">${option.dataset.text}</label>
                        </div>
                    `;
                    option.classList.remove('answer');
                    option.style.backgroundColor = 'white';
                    option.style.color = 'black';
                });

                const submitButton = document.createElement('button');
                submitButton.id = 'submit-button';
                submitButton.classList.add('btn', 'btn-primary');
                submitButton.textContent = 'é€å‡ºç­”æ¡ˆ';
                submitButton.onclick = checkMultipleChoice;
                document.querySelector('.question-content').appendChild(submitButton);
            } else {
                options.forEach((option, i) => {
                    const checkboxId = `option-${i}`;
                    option.innerHTML = `
                        <div>
                            <input type="checkbox" id="${checkboxId}" class="answer-checkbox" onchange="checkAnswer(this)">
                            <label for="${checkboxId}">${option.dataset.text}</label>
                        </div>
                    `;
                    option.classList.remove('answer');
                    option.style.backgroundColor = 'white';
                    option.style.color = 'black';
                });
            }
        } else {
            options.forEach(option => {
                if (option.dataset.answer === 'true') {
                    option.classList.add('answer');
                    option.style.backgroundColor = 'yellow';
                    option.style.color = 'red';
                } else {
                    option.style.backgroundColor = 'white';
                    option.style.color = 'black';
                }
            });
        }
    }

    function checkAnswer(checkbox) {
        const allCheckboxes = document.querySelectorAll('.answer-checkbox');
        allCheckboxes.forEach(cb => cb.disabled = true);
        const optionElement = checkbox.closest('.option');
        const isCorrect = optionElement.dataset.answer === 'true';
        showResult(isCorrect);
    }

    function checkMultipleChoice() {
        const checkboxes = document.querySelectorAll('.answer-checkbox');
        let allCorrect = true;
        let anySelected = false;

        checkboxes.forEach(checkbox => {
            const optionElement = checkbox.closest('.option');
            const isCorrect = optionElement.dataset.answer === 'true';
            if (checkbox.checked) {
                anySelected = true;
                if (!isCorrect) allCorrect = false;
            }
            if (!checkbox.checked && isCorrect) allCorrect = false;
        });

        if (!anySelected) {
            alert('è«‹é¸æ“‡è‡³å°‘ä¸€å€‹é¸é …');
            return;
        }

        checkboxes.forEach(checkbox => checkbox.disabled = true);
        showResult(allCorrect);
        const submitButton = document.getElementById('submit-button');
        if (submitButton) submitButton.remove();
        answered = true;
    }

    const correctSound = new Audio('correct_sound.mp3');
    const errorSound = new Audio('error_sound.mp3');

    function showResult(isCorrect) {
        const resultMessage = document.createElement('div');
        resultMessage.classList.add('result-message');

        if (isCorrect) {
            correctCount++;
            resultMessage.textContent = 'âœ” æ­£ç¢º';
            resultMessage.style.color = 'green';
            resultMessage.style.backgroundColor = '#d4edda';
            playCorrectSound();
        } else {
            triggerWarning();
            playErrorSound();
            incorrectCount++;
            resultMessage.textContent = 'âœ– éŒ¯èª¤';
            resultMessage.style.color = 'red';
            resultMessage.style.backgroundColor = '#f8d7da';
            revealAnswer({ target: document.getElementById('question-container') });
        }

        document.querySelector('.question-content').appendChild(resultMessage);
        setTimeout(() => resultMessage.remove(), 2000);
        updateAnswerCount();
    }

    function playCorrectSound() {
        correctSound.play();
    }

    function playErrorSound() {
        errorSound.play();
    }

    function updateAnswerCount() {
        document.getElementById('correct-count').textContent = `ç­”å°: ${correctCount}`;
        document.getElementById('incorrect-count').textContent = `ç­”éŒ¯: ${incorrectCount}`;
    }

    function revealAnswer(event) {
        if (event.target.closest('.option')) return;
        if (!answerRevealed && document.getElementById('hideAnswers').checked) {
            answerRevealed = true;
            const options = document.querySelectorAll('.option');
            options.forEach(option => {
                if (option.dataset.answer === 'true') {
                    option.style.backgroundColor = 'yellow';
                    option.style.color = 'red';
                }
            });
        }
    }

    function renderPics(picString) {
        if (!picString) return 'ç„¡';
        const urls = picString.split(',').map(url => url.trim()).filter(url => url);
        if (urls.length === 0) return 'ç„¡';
        return urls.map(url => `<img src="${url}" alt="Image">`).join('');
    }

    function prevQuestion() {
        if (filteredQuestions.length === 0) return;
        if (currentIndex > 0) {
            currentIndex--;
            answered = false;
            renderQuestion();
        } else {
            alert('å·²ç¶“æ˜¯ç¬¬ä¸€é¡Œäº†');
        }
    }

    function nextQuestion() {
        if (filteredQuestions.length === 0) return;
        if (currentIndex < filteredQuestions.length - 1) {
            currentIndex++;
            answered = false;
            renderQuestion();
        } else {
            alert('å·²ç¶“æ˜¯æœ€å¾Œä¸€é¡Œäº†');
        }
    }

    function jumpToQuestion() {
        const input = document.getElementById('jump-input');
        const index = parseInt(input.value, 10) - 1;
        if (isNaN(index) || index < 0 || index >= filteredQuestions.length) {
            alert('ç„¡æ•ˆçš„é¡Œè™Ÿ');
            return;
        }
        currentIndex = index;
        renderQuestion();
    }

    document.addEventListener('keydown', function(event) {
        switch (event.key) {
            case 'PageUp':
            case 'ArrowUp':
            case 'ArrowLeft':
                event.preventDefault();
                prevQuestion();
                break;
            case 'PageDown':
            case 'ArrowDown':
            case 'ArrowRight':
                event.preventDefault();
                nextQuestion();
                break;
            default:
                break;
        }
    });

    document.getElementById('jump-input').addEventListener('keydown', function(event) {
        if (event.key === 'Enter') {
            jumpToQuestion();
        }
    });

    const questionContainer = document.getElementById('question-container');
    let touchStartX = 0;
    let touchEndX = 0;

    questionContainer.addEventListener('touchstart', function(event) {
        touchStartX = event.changedTouches[0].screenX;
    });

    questionContainer.addEventListener('touchend', function(event) {
        touchEndX = event.changedTouches[0].screenX;
        handleSwipe();
    });

    function handleSwipe() {
        const swipeDistance = touchEndX - touchStartX;
        const minSwipeDistance = 50;

        if (window.innerWidth <= 576 && Math.abs(swipeDistance) > minSwipeDistance) {
            if (swipeDistance > 0) {
                prevQuestion();
            } else if (swipeDistance < 0) {
                nextQuestion();
            }
        }
    }

    document.querySelectorAll('.fixed-buttons button, .jump-to button').forEach(button => {
        button.addEventListener('click', function(event) {
            event.stopPropagation();
        });
    });

    function toggleRemarkVisibility() {
        const hideRemark = document.getElementById('hideRemark').checked;
        const remarkElements = document.querySelectorAll('.remark');
        remarkElements.forEach(remark => {
            remark.style.display = hideRemark ? 'none' : 'block';
        });
    }

    function toggleFeloVisibility() {
        const hideFelo = document.getElementById('hideFelo').checked;
        const feloElements = document.querySelectorAll('.felo');
        feloElements.forEach(felo => {
            felo.style.display = hideFelo ? 'none' : 'block';
        });
    }

    function togglePicVisibility() {
        const hidePic = document.getElementById('hidePic').checked;
        const picElements = document.querySelectorAll('.pic');
        picElements.forEach(pic => {
            pic.style.display = hidePic ? 'none' : 'block';
        });
    }

       function toggleMobileNotes() {
        const hidePicCheckbox = document.getElementById('hidePic');
	  hidePicCheckbox.checked = !hidePicCheckbox.checked;
	  togglePicVisibility();
    }

    function filterByQuestionType() {
        const selectedType = document.getElementById('questionTypeFilter').value;
        if (selectedType === "") {
            filteredQuestions = [...questions];
        } else {
            filteredQuestions = questions.filter(q => {
                const correctOptionsCount = q.options.filter(opt => opt.answer === true).length;
                if (selectedType === "å–®é¸é¡Œ") {
                    return correctOptionsCount === 1;
                } else if (selectedType === "è¤‡é¸é¡Œ") {
                    return correctOptionsCount > 1;
                }
            });
        }
        resetRandomIndices();
        currentIndex = 0;
        document.getElementById('total-questions').textContent = filteredQuestions.length;
        renderQuestion();
    }

    function triggerWarning() {
        const quizContainer = document.getElementById('question-container');
        quizContainer.classList.add('shake');
        setTimeout(() => quizContainer.classList.remove('shake'), 1000);
    }

    document.getElementById('toggle-checkboxes').addEventListener('click', function() {
        const hideRemarkCheckbox = document.getElementById('hideRemark');
        const hideFeloCheckbox = document.getElementById('hideFelo');
        const hidePicCheckbox = document.getElementById('hidePic');
        hideRemarkCheckbox.checked = !hideRemarkCheckbox.checked;
        hideFeloCheckbox.checked = !hideFeloCheckbox.checked;
        hidePicCheckbox.checked = !hidePicCheckbox.checked;
        toggleRemarkVisibility();
        toggleFeloVisibility();
        togglePicVisibility();
    });

    document.getElementById('fileInput').addEventListener('change', function() {
        document.getElementById('copy-button').style.display = 'block';
    });

    document.getElementById('copy-button').addEventListener('click', function() {
        copyQuestionAndOptions('question-container');
        showCopyMessage();
    });

    function copyQuestionAndOptions(divId) {
        const container = document.getElementById(divId);
        const questionText = container.querySelector("h3")?.innerText || '';
        const options = container.querySelectorAll(".option");
        let text = questionText + "\n\n";
        options.forEach(option => {
            const dataText = option.getAttribute("data-text");
            if (dataText) text += dataText + "\n";
        });
        const tempInput = document.createElement("textarea");
        tempInput.value = text;
        document.body.appendChild(tempInput);
        tempInput.select();
        document.execCommand("copy");
        document.body.removeChild(tempInput);
    }

    function showCopyMessage() {
        const message = document.createElement('div');
        message.textContent = "æ–‡å­—å·²æˆåŠŸè¤‡è£½ï¼";
        message.style.cssText = `
            position: fixed; bottom: 9.375rem; right: 0.625rem; background-color: #d4edda;
            padding: 0.625rem; border-radius: 0.3125rem; color: green; font-weight: bold;
        `;
        document.body.appendChild(message);
        setTimeout(() => message.remove(), 2000);
    }

    document.addEventListener('keydown', function(event) {
        const isAnswerHidden = document.getElementById('hideAnswers').checked;
        if (isAnswerHidden && !answered) {
            const numberPressed = event.key;
            const optionIndex = parseInt(numberPressed, 10) - 1;
            if (optionIndex >= 0 && optionIndex < filteredQuestions[currentIndex].options.length) {
                const checkboxes = document.querySelectorAll('.answer-checkbox');
                const targetCheckbox = checkboxes[optionIndex];
                if (targetCheckbox) {
                    targetCheckbox.checked = !targetCheckbox.checked;
                    if (!isMultipleChoice) {
                        checkAnswer(targetCheckbox);
                        answered = true;
                    }
                }
            }
        }
        if (isMultipleChoice && event.key === 'Enter') {
            const submitButton = document.getElementById('submit-button');
            if (submitButton) submitButton.click();
        }
    });

    document.addEventListener('keydown', function(event) {
        if (event.key === ' ') {
            const questionContainer = document.getElementById('question-container');
            if (questionContainer) {
                revealAnswer({ target: questionContainer });
            }
        }
    });

    function shuffleOptions(options) {
        const fixedOptions = options.filter(opt => 
            /(çš†æ˜¯|çš†å¦|çš†å°|çš†éŒ¯|çš†å¯|çš†é|ä»¥ä¸Šå…©é»çš†é ˆ|ä»¥ä¸Šçš†é ˆ)/.test(opt.option)
        );
        const otherOptions = options.filter(opt => 
            !/(çš†æ˜¯|çš†å¦|çš†å°|çš†éŒ¯|çš†å¯|çš†é|ä»¥ä¸Šå…©é»çš†é ˆ|ä»¥ä¸Šçš†é ˆ)/.test(opt.option)
        );
        for (let i = otherOptions.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [otherOptions[i], otherOptions[j]] = [otherOptions[j], otherOptions[i]];
        }
        return [...otherOptions, ...fixedOptions];
    }

    function applyFilters() {
        const selectedCategory = document.getElementById('categoryFilter').value;
        const keywordInput = document.getElementById('keywordFilter').value.trim();
        const feloInput = document.getElementById('feloFilter').value.trim();

        filteredQuestions = selectedCategory
            ? questions.filter(q => q.class === selectedCategory)
            : [...questions];

        if (keywordInput) {
            const keywordGroups = parseFilterInput(keywordInput);
            filteredQuestions = filteredQuestions.filter(q =>
                keywordGroups.every(group =>
                    group.some(({ type, keyword }) =>
                        type === 'INCLUDE'
                            ? q.question.includes(keyword)
                            : !q.question.includes(keyword)
                    )
                )
            );
        }

        if (feloInput) {
            const feloKeywordGroups = parseFilterInput(feloInput);
            filteredQuestions = filteredQuestions.filter(q =>
                feloKeywordGroups.every(group =>
                    group.some(({ type, keyword }) =>
                        q.felo && (type === 'INCLUDE'
                            ? q.felo.includes(keyword)
                            : !q.felo.includes(keyword))
                    )
                )
            );
        }

        resetRandomIndices();
        currentIndex = 0;
        document.getElementById('total-questions').textContent = filteredQuestions.length;
        renderQuestion();
    }
	function startinfo() {
            window.location.href = 'https://weichen5700.github.io/BotExamForever/info.html'; // å‡è¨­è¤‡ç¿’é é¢å‘½åç‚º review.html
        }
</script>
</body>
</html>
